function experiments()
% EXPERIMENTS   Run image classification experiments
%    The experimens download a number of benchmark datasets in the
%    'data/' subfolder. Make sure that there are several GBs of
%    space available.
%
%    By default, experiments run with a lite option turned on. This
%    quickly runs all of them on tiny subsets of the actual data.
%    This is used only for testing; to run the actual experiments,
%    set the lite variable to false.
%
%    Running all the experiments is a slow process. Using parallel
%    MATLAB and several cores/machiens is suggested.

% Author: Andrea Vedaldi

% Copyright (C) 2013 Andrea Vedaldi
% All rights reserved.
%
% This file is part of the VLFeat library and is made available under
% the terms of the BSD license (see the COPYING file).

lite = false;
clear ex ;

ex(1).trainOpts = {'C', 10} ;
ex(1).datasets = {'plantas'} ;
ex(1).seed = 1 ;
ex(1).prefix = 'bovw-aug' ;
ex(1).opts = {...
  'type', 'bovw', ...
  'numWords', 2048, ...
  'layouts', {'1x1'}, ...
  'geometricExtension', 'xy', ...
  'numPcaDimensions', 100, ...
  'whitening', true, ...
  'whiteningRegul', 0.01, ...
  'renormalize', true, ...
  'extractorFn', @(x) getDenseSIFT(x, ...
                                     'step', 4, ...
                                     'scales', 2.^(0:-.5:-3))};

ex(2) = ex(1) ;
ex(2).prefix = 'vlad-aug' ;
ex(2).opts = {...
  'type', 'vlad', ...
  'numWords', 128, ...
  'layouts', {'1x1'}, ...
  'geometricExtension', 'xy', ...
  'numPcaDimensions', 100, ...
  'whitening', true, ...
  'whiteningRegul', 0.01, ...
  'renormalize', true, ...
  'extractorFn', @(x) getDenseSIFT(x, ...
                                     'step', 4, ...
                                     'scales', 2.^(0:-.5:-3))};

ex(3) = ex(1);
ex(3).prefix = 'fv-aug' ;
ex(3).trainOpts = {'C', 10} ;
ex(3).datasets = {'plantas'} ;
ex(3).seed = 1 ;
ex(3).opts = {...
  'type', 'fv', ...
  'numWords', 128, ...
  'layouts', {'1x1'}, ...
  'geometricExtension', 'xy', ...
  'numPcaDimensions', 80, ...
  'extractorFn', @(x) getDenseSIFT(x, ...
                                     'step', 4, ...
                                     'scales', 2.^(0:-.5:-3))};

ex(4).prefix = 'fv' ;
ex(4).trainOpts = {'C', 10} ;
ex(4).datasets = {'plantas'} ;
ex(4).seed = 1 ;
ex(4).opts = {...
  'type', 'fv', ...
  'numWords', 128, ...
  'layouts', {'1x1'}, ...
  'geometricExtension', 'none', ...
  'numPcaDimensions', 80, ...
  'extractorFn', @(x) getDenseSIFT(x, ...
                                     'step', 4, ...
                                     'scales', 2.^(0:-.5:-3))};

ex(5).prefix = 'fv-sp' ;
ex(5).trainOpts = {'C', 10} ;
ex(5).datasets = {'plantas'} ;
ex(5).seed = 1 ;
ex(5).opts = {...
  'type', 'fv', ...
  'numWords', 128, ...
  'layouts', {'1x1', '3x1'}, ...
  'geometricExtension', 'none', ...
  'numPcaDimensions', 80, ...
  'extractorFn', @(x) getDenseSIFT(x, ...
                                     'step', 4, ...
                                     'scales', 2.^(0:-.5:-3))};

if lite
    tag = 'lite';
else
    tag = 'ex';
end

for i=1:numel(ex)
  for j=1:numel(ex(i).datasets)
    dataset = ex(i).datasets{j} ;
    if ~isfield(ex(i), 'trainOpts') || ~iscell(ex(i).trainOpts)
      ex(i).trainOpts = {} ;
    end

    % Plantas50Basic
    traintest(...
      'prefix', [tag '-' dataset '-' ex(i).prefix], ...
      'seed', ex(i).seed, ...
      'dataset', char(dataset), ...
      'datasetDir', '/usr/share/digits/digits/jobs/20160326-172626-a652', ...
      'dataDir', '~/Documents/Plantas/vlfeat/core', ...
      'lite', lite, ...
      ex(i).trainOpts{:}, ...
      'encoderParams', ex(i).opts) ;

    % Plantas50Extended
    traintest(...
      'prefix', [tag '-' dataset '-' ex(i).prefix], ...
      'seed', ex(i).seed, ...
      'dataset', char(dataset), ...
      'datasetDir', '/usr/share/digits/digits/jobs/20160326-143203-b20e', ...
      'dataDir', '~/Documents/Plantas/vlfeat/complete', ...
      'lite', lite, ...
      ex(i).trainOpts{:}, ...
      'encoderParams', ex(i).opts) ;

  end
end
